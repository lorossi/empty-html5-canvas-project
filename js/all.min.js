function createNoise2D(t){const s=buildPermutationTable(t),e=new Float64Array(s).map(t=>grad2[t%12*2]),i=new Float64Array(s).map(t=>grad2[t%12*2+1]);return function(t,o){let r=0,a=0,h=0;const n=(t+o)*F2,l=fastFloor(t+n),_=fastFloor(o+n),c=(l+_)*G2,u=l-c,d=_-c,f=t-u,m=o-d;let g,p;f>m?(g=1,p=0):(g=0,p=1);const b=f-g+G2,w=m-p+G2,y=f-1+2*G2,v=m-1+2*G2,k=255&l,C=255&_;let M=.5-f*f-m*m;if(M>=0){const t=k+s[C],o=e[t],a=i[t];M*=M,r=M*M*(o*f+a*m)}let F=.5-b*b-w*w;if(F>=0){const t=k+g+s[C+p],o=e[t],r=i[t];F*=F,a=F*F*(o*b+r*w)}let x=.5-y*y-v*v;if(x>=0){const t=k+1+s[C+1],o=e[t],r=i[t];x*=x,h=x*x*(o*y+r*v)}return 70*(r+a+h)}}function createNoise3D(t){const s=buildPermutationTable(t),e=new Float64Array(s).map(t=>grad3[t%12*3]),i=new Float64Array(s).map(t=>grad3[t%12*3+1]),o=new Float64Array(s).map(t=>grad3[t%12*3+2]);return function(t,r,a){let h,n,l,_;const c=(t+r+a)*F3,u=fastFloor(t+c),d=fastFloor(r+c),f=fastFloor(a+c),m=(u+d+f)*G3,g=u-m,p=d-m,b=f-m,w=t-g,y=r-p,v=a-b;let k,C,M,F,x,G;w>=y?y>=v?(k=1,C=0,M=0,F=1,x=1,G=0):w>=v?(k=1,C=0,M=0,F=1,x=0,G=1):(k=0,C=0,M=1,F=1,x=0,G=1):y<v?(k=0,C=0,M=1,F=0,x=1,G=1):w<v?(k=0,C=1,M=0,F=0,x=1,G=1):(k=0,C=1,M=0,F=1,x=1,G=0);const D=w-k+G3,R=y-C+G3,L=v-M+G3,A=w-F+2*G3,P=y-x+2*G3,$=v-G+2*G3,E=w-1+3*G3,U=y-1+3*G3,H=v-1+3*G3,S=255&u,z=255&d,N=255&f;let O=.6-w*w-y*y-v*v;if(O<0)h=0;else{const t=S+s[z+s[N]];O*=O,h=O*O*(e[t]*w+i[t]*y+o[t]*v)}let X=.6-D*D-R*R-L*L;if(X<0)n=0;else{const t=S+k+s[z+C+s[N+M]];X*=X,n=X*X*(e[t]*D+i[t]*R+o[t]*L)}let q=.6-A*A-P*P-$*$;if(q<0)l=0;else{const t=S+F+s[z+x+s[N+G]];q*=q,l=q*q*(e[t]*A+i[t]*P+o[t]*$)}let T=.6-E*E-U*U-H*H;if(T<0)_=0;else{const t=S+1+s[z+1+s[N+1]];T*=T,_=T*T*(e[t]*E+i[t]*U+o[t]*H)}return 32*(h+n+l+_)}}function createNoise4D(t=Math.random){const s=buildPermutationTable(t),e=new Float64Array(s).map(t=>grad4[t%32*4]),i=new Float64Array(s).map(t=>grad4[t%32*4+1]),o=new Float64Array(s).map(t=>grad4[t%32*4+2]),r=new Float64Array(s).map(t=>grad4[t%32*4+3]);return function(t,a,h,n){let l,_,c,u,d;const f=(t+a+h+n)*F4,m=fastFloor(t+f),g=fastFloor(a+f),p=fastFloor(h+f),b=fastFloor(n+f),w=(m+g+p+b)*G4,y=m-w,v=g-w,k=p-w,C=b-w,M=t-y,F=a-v,x=h-k,G=n-C;let D=0,R=0,L=0,A=0;M>F?D++:R++,M>x?D++:L++,M>G?D++:A++,F>x?R++:L++,F>G?R++:A++,x>G?L++:A++;const P=D>=3?1:0,$=R>=3?1:0,E=L>=3?1:0,U=A>=3?1:0,H=D>=2?1:0,S=R>=2?1:0,z=L>=2?1:0,N=A>=2?1:0,O=D>=1?1:0,X=R>=1?1:0,q=L>=1?1:0,T=A>=1?1:0,j=M-P+G4,B=F-$+G4,I=x-E+G4,Y=G-U+G4,J=M-H+2*G4,Q=F-S+2*G4,Z=x-z+2*G4,K=G-N+2*G4,V=M-O+3*G4,W=F-X+3*G4,tt=x-q+3*G4,st=G-T+3*G4,et=M-1+4*G4,it=F-1+4*G4,ot=x-1+4*G4,rt=G-1+4*G4,at=255&m,ht=255&g,nt=255&p,lt=255&b;let _t=.6-M*M-F*F-x*x-G*G;if(_t<0)l=0;else{const t=at+s[ht+s[nt+s[lt]]];_t*=_t,l=_t*_t*(e[t]*M+i[t]*F+o[t]*x+r[t]*G)}let ct=.6-j*j-B*B-I*I-Y*Y;if(ct<0)_=0;else{const t=at+P+s[ht+$+s[nt+E+s[lt+U]]];ct*=ct,_=ct*ct*(e[t]*j+i[t]*B+o[t]*I+r[t]*Y)}let ut=.6-J*J-Q*Q-Z*Z-K*K;if(ut<0)c=0;else{const t=at+H+s[ht+S+s[nt+z+s[lt+N]]];ut*=ut,c=ut*ut*(e[t]*J+i[t]*Q+o[t]*Z+r[t]*K)}let dt=.6-V*V-W*W-tt*tt-st*st;if(dt<0)u=0;else{const t=at+O+s[ht+X+s[nt+q+s[lt+T]]];dt*=dt,u=dt*dt*(e[t]*V+i[t]*W+o[t]*tt+r[t]*st)}let ft=.6-et*et-it*it-ot*ot-rt*rt;if(ft<0)d=0;else{const t=at+1+s[ht+1+s[nt+1+s[lt+1]]];ft*=ft,d=ft*ft*(e[t]*et+i[t]*it+o[t]*ot+r[t]*rt)}return 27*(l+_+c+u+d)}}function buildPermutationTable(t){const s=512,e=new Uint8Array(s);for(let t=0;t<s/2;t++)e[t]=t;for(let i=0;i<s/2-1;i++){const s=i+~~(t.random()*(256-i)),o=e[i];e[i]=e[s],e[s]=o}for(let t=256;t<s;t++)e[t]=e[t-256];return e}class Engine{constructor(t,s,e=60){this._canvas=t,this._ctx=s,this._fps=e,this._frameCount=0,this._actualFrameRate=0,this._noLoop=!1,this._then=null,this._recording=!1,this._first_frame_recorded=0,this._zip=null,this._setFps(this._fps),this._run()}_setFps(t){this._then=performance.now(),this._fps=t,this._fps_interval=1/this._fps}_run(){this.preload(),this.setup(),this._ctx.imageSmoothingQuality="high",this._timeDraw()}_timeDraw(){window.requestAnimationFrame(this._timeDraw.bind(this)),this._then||(this._then=performance.now());const t=performance.now(),s=t-this._then;if(!(s<this._fps_interval||this._noLoop)){if(this._ctx.save(),this.draw(),this._ctx.restore(),this._recording){const t=this._frameCount-this._first_frame_recorded,s=t.toString().padStart(7,0)+".png",e=this._canvas.toDataURL("image/png").split(";base64,")[1];this._zip.file(s,e,{base64:!0})}this._frameCount++,this._then=t-s%this._fps_interval,this._actualFrameRate=1/s}}loop(){this._noLoop=!1}noLoop(){this._noLoop=!0}startRecording(){this._recording=!0,this._first_frame_recorded=this._frameCount,this._zip=new JSZip}stopRecording(){this._recording=!1}saveRecording(t="frames.zip"){!this._recording&&this._zip&&this._zip.generateAsync({type:"blob"}).then(s=>{const e=URL.createObjectURL(s);this._downloadFile(t,e)})}saveFrame(t=null){null==t&&(t="frame-"+this._frameCount.toString().padStart(6,0)),this._downloadFile(t,this._canvas.toDataURL("image/png"))}_calculatePressCoords(t){const s=this._canvas.getBoundingClientRect(),e=Math.min(s.width,s.height)/this._canvas.getAttribute("width");if("touches"in t){if(t.touches.length>0){const i=(t.touches[0].pageX-s.left)/e,o=(t.touches[0].pageY-s.top)/e;return new Point(i,o)}return new Point(-1,-1)}{const i=(t.pageX-s.left)/e,o=(t.pageY-s.top)/e;return new Point(i,o)}}_downloadFile(t,s){const e=document.createElement("a");e.href=s,e.setAttribute("download",t),document.body.appendChild(e),e.click(),document.body.removeChild(e)}_clickCallback(t){const s=this._calculatePressCoords(t);this.click(s.x,s.y)}_mouseDownCallback(t){this._mouse_pressed=!0;const s=this._calculatePressCoords(t);this.mouseDown(s.x,s.y)}_mouseUpCallback(t){this._mouse_pressed=!1;const s=this._calculatePressCoords(t);this.mouseUp(s.x,s.y)}_mouseMoveCallback(t){const s=this._calculatePressCoords(t);this._mouse_pressed?this.mouseDragged(s.x,s.y):this.mouseMoved(s.x,s.y)}_keyDownCallback(t){this.keyDown(t.key,t.keyCode)}_keyUpCallback(t){this.keyUp(t.key,t.keyCode)}_keyPressCallback(t){this.keyPress(t.key,t.keyCode)}click(t,s){}mouseDown(t,s){}mouseDragged(t,s){}mouseUp(t,s){}mouseMoved(t,s){}keyPress(t,s){}keyDown(t,s){}keyUp(t,s){}background(t){this._ctx.save(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._ctx.fillStyle=t,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height),this._ctx.restore()}preload(){}setup(){}draw(){}get ctx(){return this._ctx}get recording(){return this._recording}get canvas(){return this._canvas}get frameCount(){return this._frameCount}get frameRate(){return this._actualFrameRate}set frameRate(t){this._setFps(t)}get width(){return this._canvas.width}get height(){return this._canvas.height}}document.addEventListener("DOMContentLoaded",()=>{let t,s,e;t=document.querySelector("#sketch"),t.getContext&&(s=t.getContext("2d",{alpha:!1}),e=new Sketch(t,s)),t.addEventListener("click",t=>e._clickCallback(t)),t.addEventListener("mousedown",t=>e._mouseDownCallback(t)),t.addEventListener("mouseup",t=>e._mouseUpCallback(t)),t.addEventListener("mousemove",t=>e._mouseMoveCallback(t)),t.addEventListener("touchstart",t=>e._mouseDownCallback(t),{passive:!0}),t.addEventListener("touchend",t=>e._mouseUpCallback(t),{passive:!0}),t.addEventListener("touchmove",t=>e._mouseMoveCallback(t),{passive:!0}),document.addEventListener("keypress",t=>e._keyPressCallback(t)),document.addEventListener("keydown",t=>e._keyDownCallback(t)),document.addEventListener("keyup",t=>e._keyUpCallback(t))});class Color{constructor(t=0,s=0,e=0,i=1,o=!0){o?(this._r=t,this._g=s,this._b=e,this._a=i,this._h=void 0,this._s=void 0,this._l=void 0,this._toHsl()):(this._h=t,this._s=s,this._l=e,this._a=i,this._r=void 0,this._g=void 0,this._b=void 0,this._toRgb())}fromHSL(t,s,e){this._h=t,this._s=s,this._l=e,this._toRgb()}fromRGB(t,s,e){this._r=t,this._g=s,this._b=e,this._toHsl()}_toHsl(){const t=this._r/255,s=this._g/255,e=this._b/255;let i,o,r=Math.max(t,s,e),a=Math.min(t,s,e),h=(r+a)/2;if(r==a)i=o=0;else{let n=r-a;switch(o=h>.5?n/(2-r-a):n/(r+a),r){case t:i=(s-e)/n+(s<e?6:0);break;case s:i=(e-t)/n+2;break;case e:i=(t-s)/n+4}i/=6}this._h=Math.floor(360*i),this._s=Math.floor(100*o),this._l=Math.floor(100*h)}_toRgb(){if(0==this._s)this._r=this._l,this._g=this._l,this._b=this._l;else{const t=(t,s,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?t+6*(s-t)*e:e<.5?s:e<2/3?t+(s-t)*(2/3-e)*6:t),s=this._l/100,e=this._h/360,i=this._s/100;let o=s<.5?s*(1+i):s+i-s*i,r=2*s-o;this._r=Math.floor(255*t(r,o,e+1/3)),this._g=Math.floor(255*t(r,o,e)),this._b=Math.floor(255*t(r,o,e-1/3))}}_toHex(t){return t=Math.floor(t),t.toString(16).padStart(2,0).toUpperCase()}_toDec(t){return parseInt(t,16)}_clamp(t,s,e){return Math.min(Math.max(s,t),e)}_wrap(t,s,e){for(;t>e;)t-=e-s;for(;t<s;)t+=e-s;return t}set hex(t){this._r=this._toDec(t.slice(1,3)),this._g=this._toDec(t.slice(3,5)),this._b=this._toDec(t.slice(5,7));const s=parseInt(t.slice(7,9),16);isNaN(s)?this._a=1:this._a=s,this._toHsl()}get hex(){return`#${this._toHex(this._r)}${this._toHex(this._g)}${this._toHex(this._a)}`}get rgb(){return`rgb(${this._r}, ${this._g}, ${this._b})`}get rgba(){return`rgba(${this._r}, ${this._g}, ${this._b}, ${this._a})`}get hsl(){return`hsl(${this._h}, ${this._s}%, ${this._l}%)`}get hsla(){return`hsla(${this._h}, ${this._s}%, ${this._l}%, ${this._a})`}get r(){return this._r}set r(t){this._r=Math.floor(this._clamp(t,0,255)),this._toHsl()}get g(){return this._g}set g(t){this._g=Math.floor(this._clamp(t,0,255)),this._toHsl()}get b(){return this._b}set b(t){this._b=Math.floor(this._clamp(t,0,255)),this._toHsl()}get a(){return this._a}set a(t){this._a=this._clamp(t,0,1)}get h(){return this._h}set h(t){this._h=Math.floor(this._wrap(t,0,360)),this._toRgb()}get s(){return this._s}set s(t){this._s=Math.floor(this._clamp(t,0,100)),this._toRgb()}get l(){return this._l}set l(t){this._l=Math.floor(this._clamp(t,0,255)),this._toRgb()}get monochrome(){return this._r==this._g&&this._g==this._b&&this._r}set monochrome(t){this._r=t,this._g=t,this._b=t,this._toHsl()}}class Point{constructor(t,s){this._x=t,this._y=s}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}}class SimplexNoise{constructor(t=null){let s;if(t){let e,i,o,r;if("number"==typeof t)e=t,i=t+1,o=t+2,r=t+3;else if("string"==typeof t){const s=this._hash(t);e=s,i=s+1,o=s+2,r=s+3}else Array.isArray(t)&&(e=t[0],i=t[1],o=t[2],r=t[3]);s=new XOR128(e,i,o,r)}else s=new XOR128;this._noise={2:createNoise2D(s),3:createNoise3D(s),4:createNoise4D(s)},this._octaves=1,this._falloff=.5}_hash(t){let s=0;if(0==t.length)return s;for(let e=0;e<t.length;e++){const i=t.charCodeAt(e);s=(s<<5)-s+i,s&=s}return s}noise(t,s=null,e=null,i=null){let o=0,r=1,a=1;const h=Math.max(arguments.length,2);for(let n=0;n<this._octaves;n++)o+=this._noise[h](t*a,s*a,e*a,i*a)*r,r*=this._falloff,a*=1/this._falloff;return o}setDetail(t=1,s=.5){this._octaves=t,this._falloff=s}set octaves(t){this._octaves=t}get octaves(){return this._octaves}set falloff(t){this._falloff=t}get falloff(){return this._falloff}}const F2=.5*(Math.sqrt(3)-1),G2=(3-Math.sqrt(3))/6,F3=1/3,G3=1/6,F4=(Math.sqrt(5)-1)/4,G4=(5-Math.sqrt(5))/20,fastFloor=t=>0|Math.floor(t),grad2=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),grad3=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class XOR128{constructor(t=null,s=null,e=null,i=null){if(null!=t&&null!=t||(t=Math.floor(4294967296*Math.random())),null!=s&&null!=t||(s=Math.floor(4294967296*Math.random())),null!=e&&null!=t||(e=Math.floor(4294967296*Math.random())),null!=i&&null!=t||(i=Math.floor(4294967296*Math.random())),"number"!=typeof t||"number"!=typeof s||"number"!=typeof e||"number"!=typeof i)throw new Error("XOR128: seed values must be numbers");if(t<1||s<1||e<1||i<1)throw new Error("XOR128: seed values must be greater than 0");this._x=t,this._y=s,this._z=e,this._w=i}random(t=null,s=null){null==t&&null==s?(t=0,s=1):null==s&&(s=t,t=0);const e=this._x^this._x<<11>>>0;return this._x=this._y,this._y=this._z,this._z=this._w,this._w=(this._w^this._w>>>19^e^e>>>8)>>>0,this._w/4294967296*(s-t)+t}random_int(t=null,s=null){return null==t&&null==s?(t=0,s=2):null==s&&(s=t,t=0),Math.floor(this.random(t,s+1))}random_interval(t=.5,s=.5){return this.random(t-s,t+s)}random_from_array(t){return t[this.random_int(0,t.length)]}shuffle_array(t){t.map(t=>({sort:this.random(),value:t})).sort((t,s)=>t.sort-s.sort).map(t=>t.value)}shuffle_string(t){t.split("").map(t=>({sort:this.random(),value:t})).sort((t,s)=>t.sort-s.sort).map(t=>t.value).join("")}}